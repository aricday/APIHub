{"ast":null,"code":"import _objectSpread from\"/Users/aricday/Projects/APIHub/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/aricday/Projects/APIHub/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useMemo}from'react';import{SimpleForm,FormDataConsumer,TextInput,useCreate,useNotify,useRefresh,required,CRUD_CREATE}from'react-admin';import{makeStyles}from'@material-ui/core';import{useForm}from'react-final-form';import slugify from'slugify';import{buildDocumentId}from'../../dataProvider/documents';import{MarkdownInput}from'../../ui';import{DocumentFormToolbar}from'./DocumentFormToolbar';var URI_ALLOWED_STRING=/^[a-zA-Z0-9_-]*$/;var URI_NOT_ALLOWED_CHARACTERS=/[^a-zA-Z0-9_-\\s]/g;export var checkSpecialCharacters=function checkSpecialCharacters(){return function(value){if(URI_ALLOWED_STRING.test(value)){return;}return'resources.apis.documentation.validation.error_no_special_characters';};};export var checkUnicity=function checkUnicity(navtitles){return function(value){if(!navtitles.map(function(navtitle){return navtitle.toLowerCase();}).includes(value.toLowerCase())){return;}return'resources.apis.documentation.validation.error_navtitle_not_unique';};};var replaceNotAllowedCharacters=function replaceNotAllowedCharacters(text){var replacement=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'_';return text.replace(URI_NOT_ALLOWED_CHARACTERS,replacement);};export var slugifyURI=function slugifyURI(uri){var cleanedURI=replaceNotAllowedCharacters(uri,'_');return slugify(cleanedURI);};var useStyles=makeStyles(function(theme){return{title:{display:'inline-block',width:'256px'},navtitle:{display:'inline-block',marginLeft:theme.spacing(4),width:'256px'},markdown:{width:'100%'}};});export var DocumentForm=function DocumentForm(_ref){var _ref$document=_ref.document,document=_ref$document===void 0?{}:_ref$document,_ref$loading=_ref.loading,loading=_ref$loading===void 0?false:_ref$loading,_ref$error=_ref.error,error=_ref$error===void 0?null:_ref$error,_ref$allDocuments=_ref.allDocuments,allDocuments=_ref$allDocuments===void 0?[]:_ref$allDocuments,_ref$onSave=_ref.onSave,onSave=_ref$onSave===void 0?function(){}:_ref$onSave,_ref$onCancel=_ref.onCancel,onCancel=_ref$onCancel===void 0?function(){}:_ref$onCancel;var classes=useStyles();var navtitles=useMemo(function(){return Object.values(allDocuments).map(function(item){return item.navtitle;});},[allDocuments]);return React.createElement(SimpleForm,{resource:\"documents\",record:document,toolbar:React.createElement(DocumentFormToolbar,{loading:loading,error:error,onCancel:onCancel}),save:onSave},React.createElement(FormDataConsumer,null,function(){// eslint-disable-next-line\nvar form=useForm();return React.createElement(React.Fragment,null,React.createElement(TextInput,{resource:\"documents\",source:\"title\",className:classes.title,onChange:function onChange(event){var navtitleFieldState=form.getFieldState('navtitle');if(navtitleFieldState.modified&&navtitleFieldState.touched){return;}var newNavtitle=slugifyURI(event.target.value);form.change('navtitle',newNavtitle);},validate:required()}),React.createElement(TextInput,{resource:\"documents\",source:\"navtitle\",className:classes.navtitle,validate:[required(),checkUnicity(navtitles),checkSpecialCharacters()]}));}),React.createElement(MarkdownInput,{source:\"markdown\",formClassName:classes.markdown,validate:required(),isRequired:true,fullWidth:true}));};export var DocumentCreateForm=function DocumentCreateForm(_ref2){var document=_ref2.document,entityType=_ref2.entityType,entityUuid=_ref2.entityUuid,_ref2$allDocuments=_ref2.allDocuments,allDocuments=_ref2$allDocuments===void 0?[]:_ref2$allDocuments,_ref2$onSaved=_ref2.onSaved,onSaved=_ref2$onSaved===void 0?function(){}:_ref2$onSaved,_ref2$onCancel=_ref2.onCancel,onCancel=_ref2$onCancel===void 0?function(){}:_ref2$onCancel;var notify=useNotify();var refresh=useRefresh();var _useCreate=useCreate('documents'),_useCreate2=_slicedToArray(_useCreate,2),create=_useCreate2[0],_useCreate2$=_useCreate2[1],loading=_useCreate2$.loading,error=_useCreate2$.error;var handleSave=function handleSave(newDocument){var documentId=buildDocumentId(entityType,entityUuid,newDocument.navtitle,newDocument.locale);create({payload:{data:_objectSpread({},newDocument,{id:documentId})}},{action:CRUD_CREATE,onSuccess:function onSuccess(_ref3){var data=_ref3.data;notify('resources.documents.notifications.create_success');refresh();onSaved(data);},onFailure:function onFailure(){notify('resources.documents.notifications.create_error');}});};return React.createElement(DocumentForm,{document:document,loading:loading,error:error,allDocuments:allDocuments,onSave:handleSave,onCancel:onCancel});};DocumentForm.__docgenInfo={\"description\":\"\",\"methods\":[],\"displayName\":\"DocumentForm\",\"props\":{\"document\":{\"defaultValue\":{\"value\":\"{}\",\"computed\":false},\"required\":false},\"loading\":{\"defaultValue\":{\"value\":\"false\",\"computed\":false},\"required\":false},\"error\":{\"defaultValue\":{\"value\":\"null\",\"computed\":false},\"required\":false},\"allDocuments\":{\"defaultValue\":{\"value\":\"[]\",\"computed\":false},\"required\":false},\"onSave\":{\"defaultValue\":{\"value\":\"() => {}\",\"computed\":false},\"required\":false},\"onCancel\":{\"defaultValue\":{\"value\":\"() => {}\",\"computed\":false},\"required\":false}}};if(typeof STORYBOOK_REACT_CLASSES!==\"undefined\"){STORYBOOK_REACT_CLASSES[\"src/apis/Documentation/DocumentCreateForm.js\"]={name:\"DocumentForm\",docgenInfo:DocumentForm.__docgenInfo,path:\"src/apis/Documentation/DocumentCreateForm.js\"};}DocumentCreateForm.__docgenInfo={\"description\":\"\",\"methods\":[],\"displayName\":\"DocumentCreateForm\",\"props\":{\"allDocuments\":{\"defaultValue\":{\"value\":\"[]\",\"computed\":false},\"required\":false},\"onSaved\":{\"defaultValue\":{\"value\":\"() => {}\",\"computed\":false},\"required\":false},\"onCancel\":{\"defaultValue\":{\"value\":\"() => {}\",\"computed\":false},\"required\":false}}};if(typeof STORYBOOK_REACT_CLASSES!==\"undefined\"){STORYBOOK_REACT_CLASSES[\"src/apis/Documentation/DocumentCreateForm.js\"]={name:\"DocumentCreateForm\",docgenInfo:DocumentCreateForm.__docgenInfo,path:\"src/apis/Documentation/DocumentCreateForm.js\"};}","map":{"version":3,"sources":["/Users/aricday/Projects/APIHub/packages/layer7-apihub/src/apis/Documentation/DocumentCreateForm.js"],"names":["React","useMemo","SimpleForm","FormDataConsumer","TextInput","useCreate","useNotify","useRefresh","required","CRUD_CREATE","makeStyles","useForm","slugify","buildDocumentId","MarkdownInput","DocumentFormToolbar","URI_ALLOWED_STRING","URI_NOT_ALLOWED_CHARACTERS","checkSpecialCharacters","value","test","checkUnicity","navtitles","map","navtitle","toLowerCase","includes","replaceNotAllowedCharacters","text","replacement","replace","slugifyURI","uri","cleanedURI","useStyles","theme","title","display","width","marginLeft","spacing","markdown","DocumentForm","document","loading","error","allDocuments","onSave","onCancel","classes","Object","values","item","form","event","navtitleFieldState","getFieldState","modified","touched","newNavtitle","target","change","DocumentCreateForm","entityType","entityUuid","onSaved","notify","refresh","create","handleSave","newDocument","documentId","locale","payload","data","id","action","onSuccess","onFailure"],"mappings":"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","sourcesContent":["import React, { useMemo } from 'react';\nimport {\n    SimpleForm,\n    FormDataConsumer,\n    TextInput,\n    useCreate,\n    useNotify,\n    useRefresh,\n    required,\n    CRUD_CREATE,\n} from 'react-admin';\nimport { makeStyles } from '@material-ui/core';\nimport { useForm } from 'react-final-form';\nimport slugify from 'slugify';\n\nimport { buildDocumentId } from '../../dataProvider/documents';\nimport { MarkdownInput } from '../../ui';\nimport { DocumentFormToolbar } from './DocumentFormToolbar';\n\nconst URI_ALLOWED_STRING = /^[a-zA-Z0-9_-]*$/;\nconst URI_NOT_ALLOWED_CHARACTERS = /[^a-zA-Z0-9_-\\s]/g;\n\nexport const checkSpecialCharacters = () => value => {\n    if (URI_ALLOWED_STRING.test(value)) {\n        return;\n    }\n    return 'resources.apis.documentation.validation.error_no_special_characters';\n};\n\nexport const checkUnicity = navtitles => value => {\n    if (\n        !navtitles\n            .map(navtitle => navtitle.toLowerCase())\n            .includes(value.toLowerCase())\n    ) {\n        return;\n    }\n    return 'resources.apis.documentation.validation.error_navtitle_not_unique';\n};\n\nconst replaceNotAllowedCharacters = (text, replacement = '_') => {\n    return text.replace(URI_NOT_ALLOWED_CHARACTERS, replacement);\n};\n\nexport const slugifyURI = uri => {\n    const cleanedURI = replaceNotAllowedCharacters(uri, '_');\n    return slugify(cleanedURI);\n};\n\nconst useStyles = makeStyles(theme => ({\n    title: {\n        display: 'inline-block',\n        width: '256px',\n    },\n    navtitle: {\n        display: 'inline-block',\n        marginLeft: theme.spacing(4),\n        width: '256px',\n    },\n    markdown: {\n        width: '100%',\n    },\n}));\n\nexport const DocumentForm = ({\n    document = {},\n    loading = false,\n    error = null,\n    allDocuments = [],\n    onSave = () => {},\n    onCancel = () => {},\n}) => {\n    const classes = useStyles();\n\n    const navtitles = useMemo(\n        () => Object.values(allDocuments).map(item => item.navtitle),\n        [allDocuments]\n    );\n\n    return (\n        <SimpleForm\n            resource=\"documents\"\n            record={document}\n            toolbar={\n                <DocumentFormToolbar\n                    loading={loading}\n                    error={error}\n                    onCancel={onCancel}\n                />\n            }\n            save={onSave}\n        >\n            <FormDataConsumer>\n                {() => {\n                    // eslint-disable-next-line\n                    const form = useForm();\n                    return (\n                        <>\n                            <TextInput\n                                resource=\"documents\"\n                                source=\"title\"\n                                className={classes.title}\n                                onChange={event => {\n                                    const navtitleFieldState = form.getFieldState(\n                                        'navtitle'\n                                    );\n\n                                    if (\n                                        navtitleFieldState.modified &&\n                                        navtitleFieldState.touched\n                                    ) {\n                                        return;\n                                    }\n\n                                    const newNavtitle = slugifyURI(\n                                        event.target.value\n                                    );\n\n                                    form.change('navtitle', newNavtitle);\n                                }}\n                                validate={required()}\n                            />\n                            <TextInput\n                                resource=\"documents\"\n                                source=\"navtitle\"\n                                className={classes.navtitle}\n                                validate={[\n                                    required(),\n                                    checkUnicity(navtitles),\n                                    checkSpecialCharacters(),\n                                ]}\n                            />\n                        </>\n                    );\n                }}\n            </FormDataConsumer>\n            <MarkdownInput\n                source=\"markdown\"\n                formClassName={classes.markdown}\n                validate={required()}\n                isRequired\n                fullWidth\n            />\n        </SimpleForm>\n    );\n};\n\nexport const DocumentCreateForm = ({\n    document,\n    entityType,\n    entityUuid,\n    allDocuments = [],\n    onSaved = () => {},\n    onCancel = () => {},\n}) => {\n    const notify = useNotify();\n    const refresh = useRefresh();\n\n    const [create, { loading, error }] = useCreate('documents');\n\n    const handleSave = newDocument => {\n        const documentId = buildDocumentId(\n            entityType,\n            entityUuid,\n            newDocument.navtitle,\n            newDocument.locale\n        );\n\n        create(\n            {\n                payload: { data: { ...newDocument, id: documentId } },\n            },\n            {\n                action: CRUD_CREATE,\n                onSuccess: ({ data }) => {\n                    notify('resources.documents.notifications.create_success');\n                    refresh();\n                    onSaved(data);\n                },\n                onFailure: () => {\n                    notify('resources.documents.notifications.create_error');\n                },\n            }\n        );\n    };\n\n    return (\n        <DocumentForm\n            document={document}\n            loading={loading}\n            error={error}\n            allDocuments={allDocuments}\n            onSave={handleSave}\n            onCancel={onCancel}\n        />\n    );\n};\n"]},"metadata":{},"sourceType":"module"}